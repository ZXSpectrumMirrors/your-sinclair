<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
 "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Nathan Cross">
	<meta name="Generator" content="Advanced Nathan Cross Simulator">
	<meta name="Description" content="Monthly Spectrum webzine 'in the style of' Your Sinclair">
	<meta name="Keywords" content="ys3, ys, your sinclair, sinclair, spectrum, zucchini, news, emulation, retrogaming, z80, zilog, assembly, programming"> 
<title>The Z80 Knights</title>
	<link rel=stylesheet type="text/css" href="ys3.css">
</head>


<body bgcolor="#7f7fff" >
<center><table  bgcolor="#fefefe" width="600" border="0" cellpadding="0" cellspacing="0"><tr><td align="center"><table width="100%"><tr><td align="left"><table width=600 bgcolor="#fefefe" cellpadding=0 cellspacing=0 border=0><tr><td align="left" valign="top"><img src="logo/z80knight.jpg"></td><td align="right" valign="top"><font face="arial, helvetica" size="1"><a href="1711019.html">1. Tilemaps</a><br><a href="17110123.html">2. Sprites</a><br><a href="17110124.html">3. Scrolling</a><br><a href="17110125.html">4. Control</a><br><a href="17110126.html">Notes</a></font></td></tr></table><font  color="#000000"><p id="edtxt"><i>Well, it's been a while, hasn't it? Still, hopefully you'll find that this installment was worth waiting for. By the end of this month's article, you should be able to put together a simple game. So, without further ado, let's jump straight in...</i></p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt"><h3>1. TILE MAPPING</h3></p></font><font  color="#000000"><p id="edtxt"></p></font><img src="img/ss_manic.gif" align="left"><font  color="#000000"><p id="edtxt">Most games take place on what is known as a 'map'. This is, generally speaking, a 2D grid of tiles that, once assembled, form a larger, coherent image. For example, if we look at this screenshot of Manic Miner we can see that the playing area is made up of blocks, each eight-by-eight pixels. But how do we get those blocks onto the screen, eh? If you're familiar with BASIC, you'll be thinking about using the plain old PRINT command. Well, that's not quite what we're going to use here. Instead, we're going to use our own custom routine. Observe:</p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt"><br><br><br><br><br></p></font><table><tr><td><font face="courier" color="#00007f">display_tile:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Tile Display Routine</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Variables needed:</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; HL - screen address to write to</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; DE - graphic data to display</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld b, 8					</td><td><font face="courier" color="#007f00">; Load B with number of rows</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">display_tile_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,(de)					</td><td><font face="courier" color="#007f00">; Load A with a byte </font><br></td></tr><tr><td><font face="courier" color="#000000">	inc de						</td><td><font face="courier" color="#007f00">; Shift DE to point at the next byte of graphic data</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a					</td><td><font face="courier" color="#007f00">; Load the current screen address with the contents of A</font><br></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110127.html">_get_next_row</a>				</td><td><font face="courier" color="#007f00">; Shift HL to point exactly one row down</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz display_tile_loop				</td><td><font face="courier" color="#007f00">; If B is not zero, decrement B and loop</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr></table><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">Straightforward enough, isn't it? That'll do just what PRINT does, more or less. So, all that's needed is to store an array of 8x8 pixel tile graphics, and an array for your tile map, and sort through them. Nice and simple. Off you go then.</p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">What's that? You're not sure exactly where to start? Oh, alright then, here you go...</p></font><font  color="#000000"><p id="edtxt"></p></font><table><tr><td><font face="courier" color="#000000">.ORG 30000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">initialise:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld hl, tmap_tilemap				</td><td><font face="courier" color="#007f00">; Load the address of the tilemap into the right place.</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapaddr),hl</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld hl, 16384					</td><td><font face="courier" color="#007f00">; Point HL at the screen</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, 0					</td><td><font face="courier" color="#007f00">; Set screen Y coordinate</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte0), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, 16					</td><td><font face="courier" color="#007f00">; Set number of rows to draw</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte1), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, 32					</td><td><font face="courier" color="#007f00">; Set number of columns to draw</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte2), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_1:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld bc, (swapaddr)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (bc)					</td><td><font face="courier" color="#007f00">; Load A with new tile</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	cp 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	jp nz, tilemap_tile1				</td><td><font face="courier" color="#007f00">; If A is not zero, check next tile value</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld de, _gfxtile00				</td><td><font face="courier" color="#007f00">; Point DE at tile 00</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp tilemap_display</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_tile1:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	cp 1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	jp nz, tilemap_tile2</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld de, _gfxtile01				</td><td><font face="courier" color="#007f00">; Point DE at tile 01</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp tilemap_display</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_tile2:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	cp 2</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	jp nz, tilemap_hloop</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld de, _gfxtile02				</td><td><font face="courier" color="#007f00">; Point DE at tile 02</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp tilemap_display</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_display:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	push hl</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	call display_tile</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	pop hl</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_hloop:						</td><td><font face="courier" color="#007f00">; Inner loop - cycle across screen</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (swapbyte2)				</td><td><font face="courier" color="#007f00">; Load A with number of columns remaining</font><br></td></tr><tr><td><font face="courier" color="#000000">	dec a						</td><td><font face="courier" color="#007f00">; Decrement A</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0						</td><td><font face="courier" color="#007f00">; Compare A with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp z, tilemap_vloop				</td><td><font face="courier" color="#007f00">; If the comparison is true, then that was the last column -</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; jump out to the vertical loop. Otherwise...</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte2), a				</td><td><font face="courier" color="#007f00">; Store the updated column counter</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc hl						</td><td><font face="courier" color="#007f00">; Increment screen pointer</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld bc, (swapaddr)				</td><td><font face="courier" color="#007f00">; Load BC with stored tilemap address</font><br></td></tr><tr><td><font face="courier" color="#000000">	inc bc						</td><td><font face="courier" color="#007f00">; Increment BC by one</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapaddr), bc				</td><td><font face="courier" color="#007f00">; Update stored tilemap address with contents of BC</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	jp tilemap_1					</td><td><font face="courier" color="#007f00">; Draw next row</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tilemap_vloop:						</td><td><font face="courier" color="#007f00">; Outer loop - cycle down screen</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, 32					</td><td><font face="courier" color="#007f00">; Reset the horizontal counter</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte2), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld bc, (swapaddr)				</td><td><font face="courier" color="#007f00">; Load BC with stored tilemap address</font><br></td></tr><tr><td><font face="courier" color="#000000">	inc bc						</td><td><font face="courier" color="#007f00">; Increment BC by one</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapaddr), bc				</td><td><font face="courier" color="#007f00">; Update stored tilemap address with contents of BC</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (swapbyte0)				</td><td><font face="courier" color="#007f00">; Load A with stored Y coordinate</font><br></td></tr><tr><td><font face="courier" color="#000000">	add a, 8					</td><td><font face="courier" color="#007f00">; Increment A by eight (the height of one tile)</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte0), a				</td><td><font face="courier" color="#007f00">; Store the updated Y coordinate</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld c,0						</td><td><font face="courier" color="#007f00">; Set column to request</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld b,a						</td><td><font face="courier" color="#007f00">; Set row to request</font><br></td></tr><tr><td><font face="courier" color="#000000">	call get_screen_offset			</td><td><font face="courier" color="#007f00">; Set HL to point at requested screen position</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (swapbyte1)				</td><td><font face="courier" color="#007f00">; Load A with the number of rows remaining</font><br></td></tr><tr><td><font face="courier" color="#000000">	dec a						</td><td><font face="courier" color="#007f00">; Decrement A</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (swapbyte1), a				</td><td><font face="courier" color="#007f00">; Store the updated rows counter</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0						</td><td><font face="courier" color="#007f00">; Compare A with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp nz, tilemap_1				</td><td><font face="courier" color="#007f00">; If it's a non-zero result, there are rows remaining -</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Jump back to the start of the loop. Otherwise, it's</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; all over, so we...</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret						</td><td><font face="courier" color="#007f00">; ...finally, return out of the tilemap program.</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">display_tile:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Tile Display Routine</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Variables needed:</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; HL - screen address to write to</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; DE - graphic data to display</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld b, 8					</td><td><font face="courier" color="#007f00">; Load B with number of rows</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">display_tile_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,(de)					</td><td><font face="courier" color="#007f00">; Load A with a byte </font><br></td></tr><tr><td><font face="courier" color="#000000">	inc de						</td><td><font face="courier" color="#007f00">; Shift DE to point at the next byte of graphic data</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a					</td><td><font face="courier" color="#007f00">; Load the current screen address with the contents of A</font><br></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110127.html">_get_next_row</a>				</td><td><font face="courier" color="#007f00">; Shift HL to point exactly one row down</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz display_tile_loop				</td><td><font face="courier" color="#007f00">; If B is not zero, decrement B and loop</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">_gfxtile00</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %00000000</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">_gfxtile01</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %11111111</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">_gfxtile02</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %10101010</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %01010101</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %10101010</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %01010101</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %10101010</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %01010101</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %10101010</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db %01010101</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">tmap_tilemap</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,2, 0,2,1,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1, 2,0,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,2, 1,2,0,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,0, 2,1,2,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">.db 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">; A quick hack to get the address of the next row down the screen</font><br></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">; Pass the current row address in HL, and it'll return into the same</font><br></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">; register pair</font><br></td></tr><tr><td><font face="courier" color="#000000"><a href="17110127.html">_get_next_row</a></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc h</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,h</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	and 7</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret nz</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,l</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	add a,32</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld l,a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret c</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,h</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	sub 8</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld h,a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapaddr</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.dw 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapaddr2</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.dw 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapaddr3</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.dw 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapbyte0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapbyte1</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapbyte2</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">swapbyte3</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	.db 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">;</font><br></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">; Pass row and column in registers b and c</font><br></td></tr><tr><td><font face="courier" color="#000000"></td><td><font face="courier" color="#007f00">;</font><br></td></tr><tr><td><font face="courier" color="#00007f">get_screen_offset:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	push de					</td><td><font face="courier" color="#007f00">; Store de safely on the stack</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld de, y_lookup				</td><td><font face="courier" color="#007f00">; Point DE at the start of the look-up table</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld h, 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld l, b					</td><td><font face="courier" color="#007f00">; Load row into HL</font><br></td></tr><tr><td><font face="courier" color="#000000">	add hl, hl					</td><td><font face="courier" color="#007f00">; Multiply hl by two, because there are two bytes for every row</font><br></td></tr><tr><td><font face="courier" color="#000000">	add hl, de					</td><td><font face="courier" color="#007f00">; Add the address of table to HL</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld e, (hl)					</td><td><font face="courier" color="#007f00">; Load de with the two-byte number stored in the LUT</font><br></td></tr><tr><td><font face="courier" color="#000000">	inc hl						</td><td><font face="courier" color="#007f00">; (2 byte numbers are stored least-significant byte first)</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld d, (hl)					</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld hl, 16384					</td><td><font face="courier" color="#007f00">; Load hl with the address of the screen</font><br></td></tr><tr><td><font face="courier" color="#000000">	add hl, de					</td><td><font face="courier" color="#007f00">; Add the offset taken from the LUT to hl</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld d, 0</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld e, c					</td><td><font face="courier" color="#007f00">; Load column into de</font><br></td></tr><tr><td><font face="courier" color="#000000">	add hl, de					</td><td><font face="courier" color="#007f00">; Add the column to hl</font><br></td></tr><tr><td><font face="courier" color="#000000">    </font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	pop de						</td><td><font face="courier" color="#007f00">; Retrieve de from the stack</font><br></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"><a href="17110128.html">y_lookup:</a></font><br></td><td><font face="courier" color="#007f00"></td></tr></table><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">It's a bit of a long one, isn't it? (Oo-er.) It's fairly well commented, but there are a few things I'd like to add. First, note that we have two methods of pointing at the right place on the screen. While the get_screen_offset function works perfectly well, it takes nearly twice as long to run as the get_next_row function. However, it's faster to use get_screen_offset once than use get_next_row eight times to point at the right place for the next row of tiles, which is why we have both functions in there. (If there are two ways of doing something, each will usually have its place.) Secondly, note that big ol' look-up table at the end. You might think it's taking up a hefty bit of space, but it's really only 384 bytes, and it saves us a huge amount of execution time. (Look-up tables are your friends.)</p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">You can cut and paste this directly into your own code, and just modify the tile graphics and tile map.</p></font><font  color="#000000"><p id="edtxt"></p></font><table></table><table></table></td></tr></table><table width="100%"><tr><td align="left"></td><td align="right"><p id="normtxt"><a href="17110123.html">Forward&gt;&gt;</a></p></td></tr></table><center><p id="normtxt"><b><a href="index1.html">Back to Contents</a></b></p></center></td></tr></table></center></body>
</html>