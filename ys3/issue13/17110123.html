<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
 "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Nathan Cross">
	<meta name="Generator" content="Advanced Nathan Cross Simulator">
	<meta name="Description" content="Monthly Spectrum webzine 'in the style of' Your Sinclair">
	<meta name="Keywords" content="ys3, ys, your sinclair, sinclair, spectrum, zucchini, news, emulation, retrogaming, z80, zilog, assembly, programming"> 
<title>The Z80 Knights</title>
	<link rel=stylesheet type="text/css" href="ys3.css">
</head>


<body bgcolor="#7f7fff" >
<center><table  bgcolor="#fefefe" width="600" border="0" cellpadding="0" cellspacing="0"><tr><td align="center"><table width="100%"><tr><td align="left"><table></table><table></table><table width=600 bgcolor="#fefefe" cellpadding=0 cellspacing=0 border=0><tr><td align="left" valign="top"><img src="logo/z80knight.jpg"></td><td align="right" valign="top"><font face="arial, helvetica" size="1"><a href="1711019.html">1. Tilemaps</a><br><a href="17110123.html">2. Sprites</a><br><a href="17110124.html">3. Scrolling</a><br><a href="17110125.html">4. Control</a><br><a href="17110126.html">Notes</a></font></td></tr></table><font  color="#000000"><p id="edtxt"><h3>2. SPRITES</h3></p></font><font  color="#000000"><p id="edtxt"></p></font><img src="img/ss_manic.gif" align="left"><font  color="#000000"><p id="edtxt">Ah, the sprite. The source of endless arguments between comp.sys.sinclair and comp.sys.cbm, the sprite is essential for our purposes here. You see Miner Willy there? He's a sprite. So are the monsters. Robocop there? He's a sprite too, and so are his bullets, and the people he's shooting. So, we'll be needing some sprites too, won't we?</p></font><font  color="#000000"><p id="edtxt"></p></font><img src="img/ss_robo.gif" align="right"><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">Sprites are a little bit more complicated than tiles. You see, whereas we can simply blast tiles onto the screen without a care in the world, sprites have to worry about what they're being displayed over. Additionally, sprites aren't always neatly aligned on the screen at multiples of eight.</p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">The first thing we need to consider is that there are two types of sprite. There's the overlapping sprite, and then there's the masked sprite. An overlapping (unmasked) sprite is one that overdraws whatever is under it, but doesn't draw any nasty blank areas around it. (Like Miner Willy.) A masked sprite (like Robo) has blank pixels inside the sprite, and as such needs to delete some of what's under it. In case that rather poor explanation wasn't enough, here's what Robocop would look like if he was an overlapping sprite.</p></font><img src="img/minirobo.gif" align="left"><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">Now, each of these types has their place. Continuing to use Robocop as an example, while Robo and the crims are masked sprites, their bullets are unmasked, and as such are faster to draw. It all depends on whether or not you have a background you need to keep intact. Since both are useful, I suppose I'm going to have to show you how to draw both. We'll start with the unmasked sprite, since it's simpler.</p></font><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt"><br><br><br><br><br></p></font><table><tr><td><font face="courier" color="#00007f">umask_sprite:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; Unmasked Sprite Routine</font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; Variables needed:</font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; B,C - screen Y,X coordinates</font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; DE - address of graphic data to display</font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110133.html">get_screen_offset</a>		</td><td><font face="courier" color="#007f00">; Position HL at the correct row</font><br></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110134.html">get_column_offset</a>		</td><td><font face="courier" color="#007f00">; Position HL at the correct column -</font><br></td></tr><tr><td><font face="courier" color="#000000">						</td><td><font face="courier" color="#007f00">; C is now set with the column offset</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld b, 8				</td><td><font face="courier" color="#007f00">; Load B with number of rows</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">umask_sprite_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,(de)				</td><td><font face="courier" color="#007f00">; Load A with a byte </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	push bc</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, c				</td><td><font face="courier" color="#007f00">; Load A with offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0					</td><td><font face="courier" color="#007f00">; Compare offset with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp z, umask_sprite_skip		</td><td><font face="courier" color="#007f00">; If offset is zero jump past the offsetting loop</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,(de)				</td><td><font face="courier" color="#007f00">; Load A with a byte </font><br></td></tr><tr><td><font face="courier" color="#000000">	ld b, c				</td><td><font face="courier" color="#007f00">; Load B with C to use as a counter</font><br></td></tr><tr><td><font face="courier" color="#00007f">umask_sprite_a_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	srl a					</td><td><font face="courier" color="#007f00">; Divide A by two</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz umask_sprite_a_loop		</td><td><font face="courier" color="#007f00">; Decrement B. If it's not zero, loop back for more shifting</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">umask_sprite_skip:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	or (hl)				</td><td><font face="courier" color="#007f00">; OR sprite data with whatever's on the screen</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, c				</td><td><font face="courier" color="#007f00">; Load A with offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0					</td><td><font face="courier" color="#007f00">; Compare offset with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp z, umask_sprite_next		</td><td><font face="courier" color="#007f00">; If offset is zero jump to do the next row</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc hl					</td><td><font face="courier" color="#007f00">; and move HL to the next screen byte</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	xor %00000111				</td><td><font face="courier" color="#007f00">; XOR offset to get left shift offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld b, a				</td><td><font face="courier" color="#007f00">; Load B with A to use as a counter</font><br></td></tr><tr><td><font face="courier" color="#000000">	inc b</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a,(de)				</td><td><font face="courier" color="#007f00">; Load A with a byte of sprite data</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">umask_sprite_b_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	sla a					</td><td><font face="courier" color="#007f00">; Shift A left</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz umask_sprite_b_loop		</td><td><font face="courier" color="#007f00">; Decrement B. If it's not zero, loop back for more shifting</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	or (hl)				</td><td><font face="courier" color="#007f00">; OR sprite data with whatever's on the screen</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	dec hl					</td><td><font face="courier" color="#007f00">; Point HL back at the previous byte</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">umask_sprite_next</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	pop bc					</td><td><font face="courier" color="#007f00">; Get the original B and C back (we need the B counter)</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc de					</td><td><font face="courier" color="#007f00">; Shift DE to point at the next byte of graphic data</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110127.html">_get_next_row</a>			</td><td><font face="courier" color="#007f00">; Shift HL to point exactly one row down</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz umask_sprite_loop		</td><td><font face="courier" color="#007f00">; If B is not zero, decrement B and loop</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr></table><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">There we go. It's a bit more complicated to draw a sprite than a tile, but that's because we need to be able to draw it at any pixel location, rather than just neat little multiples of eight. You'll notice also that we've added another helper function to find the address and offset of the right column. So, now that we know the basics, let's move on to the wonders of the masked sprite...</p></font><font  color="#000000"><p id="edtxt"></p></font><table><tr><td><font face="courier" color="#00007f">mask_sprite:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Unmasked Sprite Routine</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; Variables needed:</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; B,C - screen Y,X coordinates</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; IX - address of graphic data to display</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; </font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110133.html">get_screen_offset</a>		</td><td><font face="courier" color="#007f00">; Position HL at the correct row</font><br></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110134.html">get_column_offset</a>		</td><td><font face="courier" color="#007f00">; Position HL at the correct column -</font><br></td></tr><tr><td><font face="courier" color="#000000">							</td><td><font face="courier" color="#007f00">; C is now set with the column offset</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld b, 8				</td><td><font face="courier" color="#007f00">; Load B with number of rows</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">mask_sprite_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	push bc</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld d,(ix+8)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld e,(ix)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, c				</td><td><font face="courier" color="#007f00">; Load A with offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0					</td><td><font face="courier" color="#007f00">; Compare offset with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp z, mask_sprite_skip_1		</td><td><font face="courier" color="#007f00">; If offset is zero jump to do the next row</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld b, c				</td><td><font face="courier" color="#007f00">; Load B with C to use as a counter</font><br></td></tr><tr><td><font face="courier" color="#00007f">mask_sprite_a_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	srl d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	srl e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	set 7, d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	res 7, e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	djnz mask_sprite_a_loop		</td><td><font face="courier" color="#007f00">; Decrement B. If it's not zero, loop back for more shifting</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">mask_sprite_skip_1:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (hl)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	and d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	or e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, c				</td><td><font face="courier" color="#007f00">; Load A with offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	cp 0					</td><td><font face="courier" color="#007f00">; Compare offset with zero</font><br></td></tr><tr><td><font face="courier" color="#000000">	jp z, mask_sprite_next		</td><td><font face="courier" color="#007f00">; If offset is zero jump to do the next row</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc hl					</td><td><font face="courier" color="#007f00">; and move HL to the next screen byte</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	xor %00000111				</td><td><font face="courier" color="#007f00">; XOR offset to get left shift offset</font><br></td></tr><tr><td><font face="courier" color="#000000">	ld b, a					</td><td><font face="courier" color="#007f00">; Load B with A to use as a counter</font><br></td></tr><tr><td><font face="courier" color="#000000">	inc b</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld d,(ix+8)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld e,(ix)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">mask_sprite_b_loop:</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	sll d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	sll e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	set 0, d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	res 0, e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	djnz mask_sprite_b_loop		</td><td><font face="courier" color="#007f00">; Decrement B. If it's not zero, loop back for more shifting</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld a, (hl)</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	and d</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	or e</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ld (hl), a</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	dec hl					</td><td><font face="courier" color="#007f00">; Point HL back at the previous byte</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#00007f">mask_sprite_next</font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	pop bc					</td><td><font face="courier" color="#007f00">; Get the original B and C back (we need the B counter)</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	inc ix					</td><td><font face="courier" color="#007f00">; Shift DE to point at the next byte of graphic data</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	call <a href="17110127.html">_get_next_row</a>			</td><td><font face="courier" color="#007f00">; Shift HL to point exactly one row down</font><br></td></tr><tr><td><font face="courier" color="#000000">	djnz mask_sprite_loop			</td><td><font face="courier" color="#007f00">; If B is not zero, decrement B and loop</font><br></td></tr><tr><td><font face="courier" color="#000000"></font><br></td><td><font face="courier" color="#007f00"></td></tr><tr><td><font face="courier" color="#000000">	ret</font><br></td><td><font face="courier" color="#007f00"></td></tr></table><font  color="#000000"><p id="edtxt"></p></font><font  color="#000000"><p id="edtxt">This code assumes that the sprite is an 8x8 block again. It also assumes that the sprite is immediately followed by an 8x8 mask. This means we can use the IX register, for a bit of variety. As you can see, it's another level of complication over the unmasked sprite, but I'm sure you won't have many problems getting your head around it. Again, you can cut and paste these examples and change the sprite data to use sprites in your own code, and since the sprite routines are very self-contained, they should be extremely easy for you to use.</p></font><font  color="#000000"><p id="edtxt"></p></font></td></tr></table><table width="100%"><tr><td align="left"><p id="normtxt"><a href="17110135.html">&lt;&lt;Back</a></p></td><td align="right"><p id="normtxt"><a href="17110124.html">Forward&gt;&gt;</a></p></td></tr></table><center><p id="normtxt"><b><a href="index1.html">Back to Contents</a></b></p></center></td></tr></table></center></body>
</html>